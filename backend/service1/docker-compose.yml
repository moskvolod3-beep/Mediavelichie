services:
  editor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mediavelichie-editor
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=development
      - SUPABASE_URL=${SUPABASE_URL:-http://host.docker.internal:54321}
      - SUPABASE_KEY=${SUPABASE_KEY:-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU}
      - SUPABASE_BUCKET=${SUPABASE_BUCKET:-portfolio}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      # Монтируем код для разработки (hot reload)
      # Монтируем всю директорию, но исключаем temp и другие служебные папки
      - .:/app
      # Используем именованный volume для temp, чтобы избежать проблем с монтированием файла
      # и чтобы временные файлы не попадали на хост
      - temp-data:/app/temp
      # Исключаем node_modules и другие служебные папки, если они есть
      - /app/__pycache__
      - /app/.pytest_cache
    restart: unless-stopped
    # Для локального Supabase на хосте не нужна сеть
    # networks:
    #   - mediavelichie-network

volumes:
  temp-data:
