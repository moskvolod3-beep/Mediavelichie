# Настройка домена medvel.ru

## Шаг 1: Настройка DNS записей

### Где настраивать DNS

DNS записи настраиваются у вашего регистратора домена или DNS-провайдера (если вы используете внешний DNS сервис).

**Популярные регистраторы:**
- REG.RU
- Timeweb
- Beget
- Namecheap
- GoDaddy

### Необходимые DNS записи

Добавьте следующие записи в панели управления DNS вашего регистратора:

#### 1. A-запись (основной домен)

```
Тип: A
Имя: @ (или пустое, или medvel.ru)
Значение: 194.58.88.127
TTL: 3600 (или Auto)
```

#### 2. A-запись (поддомен www)

```
Тип: A
Имя: www
Значение: 194.58.88.127
TTL: 3600 (или Auto)
```

#### 3. CNAME-запись (альтернатива для www)

Вместо A-записи для www можно использовать CNAME:

```
Тип: CNAME
Имя: www
Значение: medvel.ru
TTL: 3600 (или Auto)
```

### Пример настройки в разных панелях

#### REG.RU

1. Войдите в панель управления
2. Перейдите в раздел "Домены" → "DNS-серверы и зона"
3. Выберите домен `medvel.ru`
4. Добавьте записи:
   - Тип: `A`, Имя: `@`, Значение: `194.58.88.127`
   - Тип: `A`, Имя: `www`, Значение: `194.58.88.127`

#### Timeweb

1. Войдите в панель управления
2. Перейдите в "Домены" → "Управление DNS"
3. Выберите домен `medvel.ru`
4. Добавьте записи:
   - Тип: `A`, Имя: `@`, Значение: `194.58.88.127`
   - Тип: `A`, Имя: `www`, Значение: `194.58.88.127`

#### Beget

1. Войдите в панель управления
2. Перейдите в "Домены" → "DNS-зона"
3. Выберите домен `medvel.ru`
4. Добавьте записи:
   - Тип: `A`, Имя: `@`, Значение: `194.58.88.127`
   - Тип: `A`, Имя: `www`, Значение: `194.58.88.127`

### DNS серверы (если нужно)

Обычно DNS серверы настраиваются автоматически регистратором. Если нужно указать вручную:

**Для REG.RU:**
```
ns1.reg.ru
ns2.reg.ru
```

**Для Timeweb:**
```
ns1.timeweb.ru
ns2.timeweb.ru
```

**Для Beget:**
```
ns1.beget.ru
ns2.beget.ru
```

## Шаг 2: Обновление конфигурации Nginx

### Вариант 1: Использование готовой конфигурации

1. Скопируйте конфигурацию для домена:

```bash
cd /opt/mediavelichia
cp frontend/nginx.domain.conf frontend/nginx.conf
```

2. Пересоберите Docker контейнер:

```bash
docker compose -f docker-compose.prod.yml build web
docker compose -f docker-compose.prod.yml up -d web
```

### Вариант 2: Ручное редактирование

Отредактируйте файл `frontend/nginx.conf`:

```nginx
server {
    listen 80;
    server_name medvel.ru www.medvel.ru;
    # ... остальная конфигурация
}
```

## Шаг 3: Проверка DNS настроек

### Проверка через командную строку

```bash
# Проверка A-записи для основного домена
dig medvel.ru +short
# Должно вернуть: 194.58.88.127

# Проверка A-записи для www
dig www.medvel.ru +short
# Должно вернуть: 194.58.88.127

# Или используйте nslookup
nslookup medvel.ru
nslookup www.medvel.ru
```

### Онлайн проверка DNS

Используйте онлайн сервисы:
- https://dnschecker.org/
- https://www.whatsmydns.net/
- https://mxtoolbox.com/DNSLookup.aspx

Введите домен `medvel.ru` и проверьте, что A-запись указывает на `194.58.88.127`.

### Проверка с сервера

```bash
# На сервере проверьте что домен резолвится
curl -I http://medvel.ru
curl -I http://www.medvel.ru
```

## Шаг 4: Проверка работоспособности

После настройки DNS (может занять до 24 часов, обычно 1-2 часа):

1. **Проверьте доступность сайта:**
   ```bash
   curl -I http://medvel.ru
   ```

2. **Откройте в браузере:**
   - http://medvel.ru
   - http://www.medvel.ru

3. **Проверьте логи Nginx:**
   ```bash
   docker logs mediavelichie-web
   ```

## Шаг 5: Настройка SSL (HTTPS) - опционально

После настройки DNS рекомендуется настроить SSL сертификат:

### Использование Let's Encrypt (Certbot)

```bash
# Установка Certbot
apt-get update
apt-get install -y certbot python3-certbot-nginx

# Получение сертификата
certbot --nginx -d medvel.ru -d www.medvel.ru

# Автоматическое обновление
certbot renew --dry-run
```

После получения сертификата обновите конфигурацию Nginx для использования SSL.

## Время распространения DNS

- **Минимальное время:** 5-15 минут
- **Обычное время:** 1-2 часа
- **Максимальное время:** до 24 часов

Это зависит от TTL (Time To Live) записей и кеширования DNS серверов.

## Устранение проблем

### Домен не резолвится

1. Проверьте DNS записи через `dig` или `nslookup`
2. Убедитесь, что A-запись указывает на правильный IP
3. Проверьте, что прошло достаточно времени для распространения DNS

### Сайт не открывается

1. Проверьте, что контейнер запущен:
   ```bash
   docker ps | grep mediavelichie-web
   ```

2. Проверьте логи:
   ```bash
   docker logs mediavelichie-web
   ```

3. Проверьте, что порт 80 открыт в firewall:
   ```bash
   ufw status
   ```

4. Проверьте конфигурацию Nginx:
   ```bash
   docker exec mediavelichie-web nginx -t
   ```

### 403 Forbidden или другие ошибки

1. Проверьте права доступа к файлам в контейнере
2. Проверьте конфигурацию Nginx
3. Проверьте логи ошибок Nginx

## Дополнительные поддомены

Если нужно добавить поддомены для других сервисов:

### Supabase Studio (опционально)

```
Тип: A
Имя: supabase
Значение: 194.58.88.127
```

Затем настройте Nginx для проксирования на порт 3000.

### Editor (опционально)

```
Тип: A
Имя: editor
Значение: 194.58.88.127
```

Затем настройте Nginx для проксирования на порт 5000.

## Полезные команды

```bash
# Проверка DNS записей
dig medvel.ru ANY
dig www.medvel.ru ANY

# Проверка доступности порта
nc -zv 194.58.88.127 80

# Проверка конфигурации Nginx
docker exec mediavelichie-web nginx -t

# Перезагрузка Nginx
docker exec mediavelichie-web nginx -s reload

# Просмотр логов
docker logs -f mediavelichie-web
```
